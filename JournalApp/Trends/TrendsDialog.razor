@namespace JournalApp.Trends
@inject ApplicationDbContext db
@inject ILogger<TrendsDialog> logger
@inject IDialogService DialogService
@inject KeycodeService KeycodeService

<MudDialog DefaultFocus="DefaultFocus.None">
	<TitleContent>
		<div class="page-header">
			<MudIconButton Icon="@Icons.Material.Filled.ArrowBack" OnClick="Submit" />

			<MudText Typo="Typo.h6">Trends</MudText>
		</div>

		<TrendsSwitcher @bind-SelectedDate="SelectedDate" />
	</TitleContent>

	<DialogContent>
		@foreach (var group in db.Categories.GroupBy(x => x.Type))
		{
			<MudText Typo="Typo.h4">@group.Key</MudText>

			@foreach (var category in group)
			{
				<MudText>@category.Name</MudText>
			}
		}
	</DialogContent>
</MudDialog>

@code {
	[CascadingParameter] MudDialogInstance MudDialog { get; set; }

	[Parameter]
	public DateOnly OpenToDate { get; set; }

	public DateOnly SelectedDate { get; set; }

	protected override void OnInitialized()
	{
		base.OnInitialized();

		KeycodeService.SubscribeOnceToBackButtonPressed(() => Submit());

		logger.LogInformation($"Opened to {OpenToDate}");
		SelectedDate = new(OpenToDate.Year, OpenToDate.Month, 1);
	}

	void Submit()
	{
		MudDialog.Close(DialogResult.Ok(true));
	}
}