@namespace JournalApp
@page "/"
@inherits LayoutComponentBase
@inject ApplicationDbContext db;

<Layout>
	<Header Id="app-header">
		<Row>
			<Col Flex=@("none")>
			<span style="color: #512BD4;">JournalApp </span>
			<Icon Type="@IconType.Outline.Smile" Theme="@IconThemeType.Twotone" TwotoneColor="white" />
			</Col>

			<Col Flex=@("auto") />

			<Col Flex=@("none")>
			<Dropdown Placement="@Placement.TopRight">
				<ChildContent>
					<Button Type="@ButtonType.Primary" Icon="@IconType.Outline.Plus" />
				</ChildContent>

				<Overlay>
					<Menu>
						<MenuItem Icon="@IconType.Outline.FileAdd" OnClick="@(() => NewNote())">
							<span> New note</span>
						</MenuItem>
					</Menu>
				</Overlay>
			</Dropdown>
			</Col>
		</Row>
	</Header>

	<Content Id="app-body">
		<AntList DataSource="@db.Entries" Grid="grid">
			@if (!@context.IsDeleted)
			{
				@if (@context.GetType() == typeof(Note))
				{
					<ListItem>
						<NoteCard Note="@((Note)context)" />
					</ListItem>
				}
				else
				{
					<ListItem>
						<p>@(context.Date.ToString())</p>
					</ListItem>
				}
			}
		</AntList>
	</Content>
</Layout>

<AntContainer />

@code {
	ListGridType grid = new()
		{
			Gutter = 8,
			Xs = 1,
			Sm = 2,
			Md = 2,
			Lg = 3,
			Xl = 3,
			Xxl = 3,
		};

	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();
	}

	void NewNote()
	{
		db.Entries.Add(new JournalEntry { Date = DateTime.Now });
		db.SaveChanges();
	}
}