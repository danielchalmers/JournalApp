@namespace JournalApp
@inject ApplicationDbContext db
@inject IDialogService DialogService

<MudDialog>
	<DialogContent>
		<MudDataGrid Items="db.DataPointCategories" SortMode="SortMode.None" EditMode="DataGridEditMode.Cell" ReadOnly="false" Class="mr-16" Dense="true">
			<Columns>
				<PropertyColumn Property="x => x.Name" />
				<PropertyColumn Property="x => x.Index" />
				<PropertyColumn Property="x => x.Enabled" />
				<PropertyColumn Property="x => x.Type" />
			</Columns>
		</MudDataGrid>

		<MudButton Color="Color.Secondary" Variant="Variant.Filled" OnClick="New">Create a new category...</MudButton>
	</DialogContent>

	<DialogActions>
		<MudButton Color="Color.Primary" OnClick="Submit">Done</MudButton>
	</DialogActions>
</MudDialog>

@code {
	[CascadingParameter] MudDialogInstance MudDialog { get; set; }

	async Task New()
	{
		var result = await DialogService.Show<NewDataPointCategory>().Result;

		if (result.Canceled)
			return;

		var newCategory = (DataPointCategory)result.Data;
		newCategory.Index = db.DataPointCategories.Max(x => x.Index) + 1;

		db.DataPointCategories.Add(newCategory);
		await db.SaveChangesAsync();
	}

	async Task Submit()
	{
		await db.SaveChangesAsync();
		MudDialog.Close(DialogResult.Ok(true));
	}
}