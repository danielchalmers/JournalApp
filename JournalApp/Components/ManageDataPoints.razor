@namespace JournalApp
@inject ApplicationDbContext db
@inject IDialogService DialogService

<MudDialog>
	<DialogContent>
		<MudButton OnClick="New">Add Data Point Category</MudButton>

		<MudDataGrid Items="db.DataPointCategories">
			<Columns>
				<PropertyColumn Property="x => x.Name" />
				<PropertyColumn Property="x => x.SequenceNumber" />
				<PropertyColumn Property="x => x.Enabled" />
				<PropertyColumn Property="x => x.Type" />
			</Columns>
		</MudDataGrid>
	</DialogContent>

	<DialogActions>
		<MudButton Color="Color.Primary" OnClick="Submit">Done</MudButton>
	</DialogActions>
</MudDialog>

@code {
	[CascadingParameter] MudDialogInstance MudDialog { get; set; }

	async Task New()
	{
		var result = await DialogService.Show<NewDataPointCategory>().Result;

		if (result.Canceled)
			return;

		var newCategory = (DataPointCategory)result.Data;
		newCategory.SequenceNumber = db.DataPointCategories.Max(x => x.SequenceNumber) + 1;

		db.DataPointCategories.Add(newCategory);
	}

	void Submit()
	{
		MudDialog.Close(DialogResult.Ok(true));
	}
}