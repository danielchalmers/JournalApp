@namespace JournalApp
@inherits LayoutComponentBase
@implements IDisposable
@inject KeyEventService KeyEventService
@inject NavigationManager NavigationManager

<MudThemeProvider Theme="AppTheme" IsDarkMode />

<MudDialogProvider MaxWidth="MaxWidth.Medium"
				   NoHeader="false"
				   CloseButton="false"
				   CloseOnEscapeKey="false"
				   Position="DialogPosition.Center" />

<MudSnackbarProvider />

<div class="page">
	@Body
</div>

@code {
	MudTheme AppTheme { get; } = new()
		{
			PaletteDark = new PaletteDark() { TextDisabled = "#ffffffb2" },
			LayoutProperties = new() { AppbarHeight = "4em" },
		};

	protected override void OnInitialized()
	{
		base.OnInitialized();

		App.NewIntent += NewIntent;

		// All pages have been reloaded so we should clear any leftover subscriptions.
		KeyEventService.ResetStack();

		// Start import.
		if (App.ActivatedFilePath != null)
		{
			NavigationManager.NavigateTo($"/settings", false, true);
		}
	}

	void NewIntent(object sender, EventArgs e)
	{
		NavigationManager.NavigateTo($"/settings", true, true);
	}

	public void Dispose()
	{
		App.NewIntent -= NewIntent;
	}
}