@namespace JournalApp
@inject PreferenceService PreferenceService

@if (_isVisible)
{
    <div class="mood-animation-overlay @GetAnimationClass()" style="background-color: @_color;" @onclick="Hide">
        <div class="mood-animation-content">
            <div class="mood-animation-emoji">@_emoji</div>
        </div>
        @if (!string.IsNullOrEmpty(GetEffectClass()))
        {
            <div class="mood-animation-effects @GetEffectClass()"></div>
        }
    </div>
}

@code {
    private bool _isVisible = false;
    private string _emoji = "";
    private string _color = "transparent";

    public void Show(string emoji)
    {
        _emoji = emoji;
        _color = PreferenceService.GetMoodColor(emoji);
        _isVisible = true;
        StateHasChanged();

        // Auto-hide after animation completes (slightly before animation ends to avoid lag)
        Task.Delay(1400).ContinueWith(_ =>
        {
            InvokeAsync(() =>
            {
                Hide();
            });
        });
    }

    private void Hide()
    {
        _isVisible = false;
        StateHasChanged();
    }

    private string GetAnimationClass()
    {
        return _emoji switch
        {
            "ðŸ˜­" => "crying-animation",
            "ðŸ˜¢" => "sad-animation",
            "ðŸ˜•" => "confused-animation",
            "ðŸ˜" => "neutral-animation",
            "ðŸ™‚" => "slight-smile-animation",
            "ðŸ˜€" => "happy-animation",
            "ðŸ¤©" => "excited-animation",
            _ => ""
        };
    }

    private string GetEffectClass()
    {
        return _emoji switch
        {
            "ðŸ˜­" => "rain-effect",
            "ðŸ˜¢" => "rain-effect light",
            "ðŸ˜•" => "clouds-effect",
            "ðŸ˜" => "",
            "ðŸ™‚" => "sparkles-effect",
            "ðŸ˜€" => "sunshine-effect",
            "ðŸ¤©" => "stars-effect",
            _ => ""
        };
    }
}
