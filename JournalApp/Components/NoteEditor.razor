@namespace JournalApp
@using System.ComponentModel.DataAnnotations
@using System.Text.Json

@{
	RenderFragment modalFooter = @<Template>
		<Popconfirm Title="Delete?" OkText="Yes" CancelText="Cancel" OnConfirm="OnDelete">
			<Button Type="@ButtonType.Dashed" Color="Color.Red1">Delete</Button>
		</Popconfirm>
		<Button OnClick="@OnOk" @key="@( "submit" )" Type="@ButtonType.Primary">Update</Button>
		<Button OnClick="@OnCancel" @key="@( "back" )">Close</Button>
	</Template>;
}

<Modal Title="Edit Note"
	   Visible="@Visible"
	   Footer="@modalFooter">
	<Form Model="@Model"
		  OnFinish="OnFinish"
		  @ref="@_form">
		<FormItem Label="Today's note">
			<InputTextArea @bind-Value="@context.Text" />
		</FormItem>
	</Form>
</Modal>

@code {
	Form<Note> _form;

	[Parameter]
	public bool Visible { get; set; }

	[Parameter]
	public Note Model { get; set; }

	void OnDelete()
	{
		Model.IsDeleted = true;
		Visible = false;
	}

	void OnOk(MouseEventArgs e)
	{
		_form.Submit();
	}

	void OnCancel(MouseEventArgs e)
	{
		Visible = false;
	}

	void OnFinish(EditContext editContext)
	{
		Visible = false;
	}
}