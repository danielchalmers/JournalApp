@namespace JournalApp
@using System.ComponentModel.DataAnnotations
@using System.Text.Json
@inject IDialogService DialogService

<MudCard>
	<MudCardContent>
		@if (Full)
		{
			<MudDatePicker @bind-Date="@Model.Date" />
		}
		else
		{
			@Model.Date.ToString()
		}

		@if (@Model is Note note)
		{
			<MudTextField Lines="4" Placeholder="What's on your mind?" @bind-Value="note.Text" @onfocus="OnFocus" OnBlur="OnBlur" />
		}
	</MudCardContent>

	@if (Full)
	{
		<MudCardActions>
			<MudButton OnClick="OnDelete" StartIcon="@Icons.Material.Outlined.Delete">Delete</MudButton>

			<MudButton OnClick="OnOk" StartIcon="@Icons.Material.Outlined.Update">Update</MudButton>

			<MudButton OnClick="OnCancel" StartIcon="@Icons.Material.Outlined.Cancel">Close</MudButton>
		</MudCardActions>
	}
</MudCard>

@code {
	[CascadingParameter] MudDialogInstance MudDialog { get; set; }

	[Parameter]
	public bool Full { get; set; }

	[Parameter]
	public JournalEntry Model { get; set; }

	async void OnDelete()
	{
		if (await DialogService.ShowMessageBox("Delete entry", $"This entry from {Model.Date} will be deleted.", yesText: "Delete", noText: "Keep it") == true)
			return;

		Model.IsDeleted = true;
	}

	void OnOk()
	{
	}

	void OnCancel()
	{
	}

	void OnFocus()
	{
		Full = true;

		// Open self in a dialog like Twitter for full editing experience
	}

	void OnBlur()
	{
		//Full = false;
	}
}